{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../plugins/public/search/indico_search/client/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","global","$t","$T","domain","type","_highlight","elem","token","idx","toLowerCase","indexOf","before","slice","after","length","Html","span","_truncateTitle","title","max","_showSuggestions","text","suggList","totalNumber","self","this","suggestionBox","WatchValue","suggestionList","ul","infoBox","div","gettext","style","position","top","pixels","left","className","$B","number","container","append","tokens","_","filter","escapeHTML","split","tokenRE","RegExp","join","counter","titleHtml","replace","index","dom","innerHTML","pathText","Util","truncateCategPath","path","liItem","li","observeEvent","selectorPos","_clearSelector","_setSelector","observeClick","window","location","url","set","_hideSuggestions","remove","suggestions","_retrieveOptions","expression","querying","$","ajax","searchUrl","data","term","dataType","complete","timeOfLastQuery","Date","getTime","success","handleAjaxError","results","count","currentText","trim","_textTyped","_getTimeSinceLastQuery","_waitForRequestTime","queuedRequest","setTimeout","_openSelection","event","_moveSelector","direction","suggNum","item","isAnyItemSelected","args","autocomplete","RealtimeTextBox","observe","observeOtherKeys","$E","document","body","ancestorOf","eventTarget","input","widget","options","categ_title","everywhere","search_category_url","search_url","form","_transition","no_check","$tag","fadeTo","find","html","_create","tag_template","template","element","replaceWith","$where","addClass","hide","show","on","search_everywhere","$parent","parent","show_categ","e","show_tip","removeData","confirm_tip","back_to_everywhere","qtip","fadeOut","fadeIn","removeClass","attr","animate","content","format","at","my","ready","categorySearchBox","extra","controls","extraConfigured","verifyForm","startDate","val","endDate","parseDateTime","IndicoDateTimeFormats","DefaultHourless","is","slideUp","slideDown","css","of","intelligentSearchBox","IntelligentSearchBox","id","backgroundColor","outline","categoryNamesUrl","draw","submit","which","isRoot","search_tag","categoryName","searchCategoryUrl"],"mappings":"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","file":"js/main.a637af60.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/static/plugins/search/dist/\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","// This file is part of the Indico plugins.\n// Copyright (C) 2002 - 2020 CERN\n//\n// The Indico plugins are free software; you can redistribute\n// them and/or modify them under the terms of the MIT License;\n// see the LICENSE file for more details.\n\nimport './main.scss';\n\n(function(global) {\n  const $t = $T.domain('search');\n\n  type(\n    'IntelligentSearchBox',\n    ['RealtimeTextBox'],\n    {\n      _highlight(elem, token) {\n        // Code for highlighting the matched part of the string\n        const idx = elem.toLowerCase().indexOf(token.toLowerCase());\n        if (idx >= 0) {\n          const before = elem.slice(0, idx);\n          const after = elem.slice(idx + token.length, elem.length);\n          return [before, Html.span('highlight', elem.slice(idx, idx + token.length)), after];\n        }\n      },\n\n      _truncateTitle(title) {\n        const max = 27;\n        if (title.length > max) {\n          return `${title.slice(0, max / 2)} ... ${title.slice(-max / 2)}`;\n        } else {\n          return title;\n        }\n      },\n\n      _showSuggestions(text, suggList, totalNumber) {\n        const self = this;\n        if (!this.suggestionBox) {\n          // Create the suggestion box only once\n\n          // totalNumber will change during time\n          this.totalNumber = new WatchValue(totalNumber);\n          this.suggestionList = Html.ul();\n\n          const infoBox = Html.div('help', $t.gettext('Some category suggestions...'));\n\n          // Create the suggestion box\n          this.suggestionBox = Html.div(\n            {\n              style: {\n                position: 'absolute',\n                top: pixels(23),\n                left: 0,\n              },\n              className: 'suggestion-box',\n            },\n            infoBox,\n            this.suggestionList,\n            $B(Html.div('other-results'), this.totalNumber, function(number) {\n              return number === 0\n                ? ''\n                : `${number} ${$t.gettext('other results - please write more...')}`;\n            })\n          );\n\n          this.container.append(this.suggestionBox);\n        }\n\n        // Prepare regular expression for highlighting\n        const tokens = _.filter(escapeHTML(text).split(' '), function(t) {\n          return t !== '';\n        });\n        const tokenRE = new RegExp(`(${tokens.join('|')})`, 'gi');\n\n        // Bind the list to the DOM element\n        let counter = 0;\n\n        $B(this.suggestionList, suggList, function(elem) {\n          const titleHtml = escapeHTML(self._truncateTitle(elem.title)).replace(\n            tokenRE,\n            '<span class=\"highlight\">$1</span>'\n          );\n          const index = counter;\n          const title = Html.span('title');\n          title.dom.innerHTML = titleHtml;\n          const pathText = Util.truncateCategPath(elem.path).join(' >> ');\n          const path = Html.div('path', pathText);\n          const liItem = Html.li({}, title, path);\n\n          // Use mouse to control selector as well\n\n          liItem.observeEvent('mouseover', function() {\n            if (self.selectorPos != index) {\n              self._clearSelector();\n              self.selectorPos = index;\n              self._setSelector();\n            }\n          });\n\n          liItem.observeClick(function() {\n            window.location = elem.url;\n          });\n\n          counter++;\n          return liItem;\n        });\n\n        this.suggestionList.observeEvent('mouseout', function() {\n          self._clearSelector();\n          self.selectorPos = -1;\n        });\n\n        // Update\n        this.totalNumber.set(totalNumber);\n      },\n\n      _hideSuggestions() {\n        this.container.remove(this.suggestionBox);\n        this.suggestionBox = null;\n        this.selectorPos = -1;\n        this.suggestions = null;\n      },\n\n      _retrieveOptions(expression) {\n        const self = this;\n        this.querying = true;\n\n        $.ajax({\n          url: self.searchUrl,\n          type: 'GET',\n          data: {\n            term: expression,\n          },\n          dataType: 'json',\n          complete() {\n            self.querying = false;\n            self.timeOfLastQuery = new Date().getTime();\n          },\n          success(data) {\n            if (handleAjaxError(data)) {\n              return;\n            }\n\n            if (data.results.length) {\n              self.suggestions = data.results;\n              self._showSuggestions(expression, data.results, data.count - data.results.length);\n            } else {\n              self._hideSuggestions();\n            }\n\n            const currentText = trim(self.get());\n\n            // if the text changed meanwhile and it\n            // is still long enough\n            if (currentText != expression && currentText.length > 1) {\n              // request\n              self._textTyped();\n            } else if (currentText.length <= 1) {\n              // if it is not long enough\n              self._hideSuggestions();\n            }\n          },\n        });\n      },\n\n      _getTimeSinceLastQuery() {\n        const now = new Date();\n        return now.getTime() - this.timeOfLastQuery;\n      },\n\n      _waitForRequestTime() {\n        const self = this;\n        if (!this.queuedRequest) {\n          // This should never happen...\n          return;\n        }\n\n        if (this._getTimeSinceLastQuery() > 1000) {\n          this._textTyped();\n          this.queuedRequest = false;\n        } else {\n          setTimeout(function() {\n            self._waitForRequestTime();\n          }, 300);\n        }\n      },\n\n      /*\n       * Called each time a new character is typed\n       * strips white spaces, and calls for a request if needed\n       */\n      _textTyped(key) {\n        const self = this;\n        const text = trim(this.get());\n\n        if (text.length > 1) {\n          // if we're not already querying and enough time has passed\n          // since the last request\n          if (!this.querying && this._getTimeSinceLastQuery() > 1000) {\n            this._retrieveOptions(text);\n          } else if (!this.queuedRequest) {\n            // otherwise, if we can't do a request right now\n            // and no other request is queued\n            this.queuedRequest = true;\n\n            setTimeout(function() {\n              self._waitForRequestTime();\n            }, 300);\n          }\n        } else if (this.suggestionBox) {\n          this._hideSuggestions();\n        }\n      },\n\n      _openSelection(event) {\n        if (this.selectorPos >= 0) {\n          window.location = this.suggestions[this.selectorPos].url;\n          return false;\n        }\n        return true;\n      },\n\n      /*\n       * Move the selector (gray area) up or down\n       */\n      _moveSelector(direction) {\n        if (this.suggestionBox) {\n          const suggNum = this.suggestionList.length.get();\n\n          if (this.selectorPos < 0) {\n            this.selectorPos = direction == 'down' ? 0 : suggNum - 1;\n          } else {\n            this._clearSelector();\n            this.selectorPos += direction == 'up' ? -1 : 1;\n\n            if (this.selectorPos >= suggNum) {\n              this.selectorPos = -1;\n            } else if (this.selectorPos < 0) {\n              this.selectorPos = -1;\n            }\n          }\n        }\n\n        this._setSelector();\n      },\n\n      _setSelector() {\n        if (this.selectorPos >= 0) {\n          this.suggestionList.item(this.selectorPos).dom.className = 'selected';\n        }\n      },\n\n      _clearSelector() {\n        if (this.selectorPos >= 0) {\n          this.suggestionList.item(this.selectorPos).dom.className = '';\n        }\n      },\n\n      isAnyItemSelected() {\n        return this.selectorPos > 0;\n      },\n    },\n    function(args, container, searchUrl) {\n      args.autocomplete = 'off';\n      this.RealtimeTextBox(args);\n      this.selectorPos = -1;\n      this.querying = false;\n      this.container = container;\n      this.timeOfLastQuery = 0;\n      this.searchUrl = searchUrl;\n\n      const self = this;\n\n      this.observe(function(key, event) {\n        self._textTyped(key);\n        return true;\n      });\n\n      this.observeOtherKeys(function(text, key, event) {\n        if (key == 38 || key == 40) {\n          self._moveSelector(key == 38 ? 'up' : 'down');\n          return false;\n        } else if (key == 27) {\n          self._hideSuggestions();\n          return false;\n        } else if (key == 13) {\n          return self._openSelection(event);\n        } else {\n          return true;\n        }\n      });\n\n      $E(document.body).observeClick(function(event) {\n        // Close box if a click is done outside of it\n\n        /* for some unknown reason, onclick is called on the submit button,\n         * as soon as the return key is pressed in any of the textfields.\n         * To make it even better, onclick is called before onkeyup,\n         * which forces us to do the last two checks.\n         */\n\n        if (\n          self.suggestionBox &&\n          !self.suggestionList.ancestorOf($E(eventTarget(event))) &&\n          $E(eventTarget(event)) != self.input\n        ) {\n          self._hideSuggestions();\n        }\n      });\n    }\n  );\n\n  $.widget('indico.search_tag', {\n    options: {\n      categ_title: 'Home',\n      everywhere: true,\n      search_category_url: '#',\n      search_url: '#',\n      form: null,\n    },\n\n    _transition(title, no_check) {\n      const $tag = this.$tag;\n\n      $tag\n        .fadeTo('fast', 0.3)\n        .find('.where')\n        .html(title);\n\n      $tag\n        .fadeTo('fast', 0.5)\n    },\n\n    _create() {\n      const self = this;\n\n      const tag_template = _.template(\n        '<div class=\"search-tag\">' +\n          '<div class=\"where\"><%= categ_title %></div>' +\n          '<div class=\"cross\">x</div>' +\n          '</div>'\n      );\n\n      const $tag = (this.$tag = $(\n        tag_template({\n          categ_title: this.options.everywhere\n            ? $t.gettext('Everywhere')\n            : this.options.categ_title,\n        })\n      ));\n\n      $(this.element).replaceWith($tag);\n      const $where = $('.where', $tag);\n\n      if (this.options.everywhere) {\n        $tag.addClass('everywhere');\n        $('.cross', this.$tag).hide();\n      } else {\n        $tag.addClass('in-category');\n        $('.cross', this.$tag).show();\n      }\n\n      $('.cross', $tag).on('click', function() {\n        self.search_everywhere();\n      });\n\n      const $parent = $tag.parent();\n\n      $parent.on('mouseenter', '.search-tag.everywhere', function() {\n        self.show_categ();\n      });\n      $parent.on('mouseover', '.search-tag.everywhere', function(e) {\n        self.show_tip(e);\n      });\n      $parent.on('mouseleave', '.search-tag.everywhere', function() {\n        $where.removeData('hasFocus');\n      });\n      $parent.on('click', '.search-tag.in-category-over', function() {\n        self.confirm_tip();\n      });\n      $parent.on('mouseleave', '.search-tag.in-category-over', function() {\n        self.back_to_everywhere();\n      });\n    },\n\n    confirm_tip() {\n      const $where = $('.where', this.$tag);\n      const $tag = this.$tag;\n\n      $tag.qtip('destroy');\n      $where.fadeOut('fast', function() {\n        $(this).fadeIn('fast');\n      });\n\n      this.$tag\n        .addClass('in-category')\n        .removeClass('everywhere')\n        .removeClass('in-category-over');\n      this.options.form.attr('action', this.options.search_category_url);\n\n      $tag.animate(\n        200,\n        'swing',\n        function() {\n          $('.cross', $tag).fadeIn('fast');\n        }\n      );\n    },\n\n    search_everywhere() {\n      $('.cross', this.$tag).hide();\n      this.$tag.addClass('everywhere').removeClass('in-category');\n      this._transition($t.gettext('Everywhere'), true);\n      this.options.form.attr('action', this.options.search_url);\n    },\n\n    show_categ() {\n      const $tag = this.$tag;\n      const $where = $('.where', $tag);\n      const self = this;\n      $where.data('hasFocus', true);\n      setTimeout(function() {\n        if ($where.data('hasFocus')) {\n          self._transition(self.options.categ_title);\n          $tag.addClass('in-category-over');\n        }\n      }, 200);\n    },\n\n    show_tip(event) {\n      this.$tag.qtip(\n        {\n          content: format($t.gettext('Click to search inside <span class=\"label\">{title}</span>'), {\n            title: this.options.categ_title,\n          }),\n          position: {\n            at: 'bottom center',\n            my: 'top center',\n          },\n          show: {\n            event: event.type,\n            ready: true,\n          },\n        },\n        event\n      );\n    },\n\n    back_to_everywhere() {\n      const $where = $('.where', this.$tag);\n      const self = this;\n\n      this.$tag.removeClass('in-category-over');\n      $where.removeData('hasFocus');\n      setTimeout(function() {\n        if (!$where.data('hasFocus')) {\n          self._transition($t.gettext('Everywhere'), true);\n          self.$tag.addClass('everywhere');\n        }\n      }, 200);\n    },\n  });\n\n  global.categorySearchBox = function categorySearchBox(options) {\n    // expected options: categoryNamesUrl, searchUrl, searchCategoryUrl, categoryName, isRoot\n    const form = $('#category-search-form');\n    const extra = form.find('.extra-options');\n    const controls = form.find('.search-controls');\n    let extraConfigured = false;\n    $('#category-search-expand').on('click', function() {\n      if (extra.is(':visible')) {\n        extra.slideUp('fast');\n      } else {\n        extra.slideDown('fast');\n        if (!extraConfigured) {\n          extraConfigured = true;\n          extra.css('display', 'table').position({\n            of: controls,\n            my: 'right top',\n            at: 'right bottom',\n          });\n        }\n      }\n    });\n\n    function verifyForm() {\n      const startDate = $('#search-start_date').val();\n      const endDate = $('#search-end_date').val();\n      return (\n        (!startDate || Util.parseDateTime(startDate, IndicoDateTimeFormats.DefaultHourless)) &&\n        (!endDate || Util.parseDateTime(endDate, IndicoDateTimeFormats.DefaultHourless))\n      );\n    }\n\n    const intelligentSearchBox = new IntelligentSearchBox(\n      {\n        name: 'search-phrase',\n        id: 'search-phrase',\n        style: {backgroundColor: 'transparent', outline: 'none'},\n      },\n      $E('category-search-box'),\n      options.categoryNamesUrl\n    );\n\n    $E('search-phrase').replaceWith(intelligentSearchBox.draw());\n\n    $('.search-button').on('click', function() {\n      if (verifyForm()) {\n        $('#category-search-form').submit();\n      }\n    });\n\n    $('#search-phrase').on('keypress', function(e) {\n      if (e.which == 13 && !intelligentSearchBox.isAnyItemSelected()) {\n        if (verifyForm()) {\n          $('#category-search-form').submit();\n        }\n      }\n    });\n\n    if (!options.isRoot) {\n      $('#category-search-form .search-button').before($('<div class=\"search-tag\">'));\n      $('.search-tag').search_tag({\n        everywhere: true,\n        categ_title: options.categoryName,\n        form: $('#category-search-form'),\n        search_url: options.searchUrl,\n        search_category_url: options.searchCategoryUrl,\n      });\n    }\n  };\n})(window);\n"],"sourceRoot":""}