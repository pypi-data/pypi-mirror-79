!function(e){var t={};function s(o){if(t[o])return t[o].exports;var i=t[o]={i:o,l:!1,exports:{}};return e[o].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(o,i,function(t){return e[t]}.bind(null,i));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/static/plugins/search/dist/",s(s.s=0)}([function(e,t,s){"use strict";s.r(t);s(1);!function(e){const t=$T.domain("search");type("IntelligentSearchBox",["RealtimeTextBox"],{_highlight(e,t){const s=e.toLowerCase().indexOf(t.toLowerCase());if(s>=0){const o=e.slice(0,s),i=e.slice(s+t.length,e.length);return[o,Html.span("highlight",e.slice(s,s+t.length)),i]}},_truncateTitle:e=>e.length>27?`${e.slice(0,13.5)} ... ${e.slice(-13.5)}`:e,_showSuggestions(e,s,o){const i=this;if(!this.suggestionBox){this.totalNumber=new WatchValue(o),this.suggestionList=Html.ul();const e=Html.div("help",t.gettext("Some category suggestions..."));this.suggestionBox=Html.div({style:{position:"absolute",top:pixels(23),left:0},className:"suggestion-box"},e,this.suggestionList,$B(Html.div("other-results"),this.totalNumber,(function(e){return 0===e?"":`${e} ${t.gettext("other results - please write more...")}`}))),this.container.append(this.suggestionBox)}const r=_.filter(escapeHTML(e).split(" "),(function(e){return""!==e})),n=new RegExp(`(${r.join("|")})`,"gi");let a=0;$B(this.suggestionList,s,(function(e){const t=escapeHTML(i._truncateTitle(e.title)).replace(n,'<span class="highlight">$1</span>'),s=a,o=Html.span("title");o.dom.innerHTML=t;const r=Util.truncateCategPath(e.path).join(" >> "),c=Html.div("path",r),h=Html.li({},o,c);return h.observeEvent("mouseover",(function(){i.selectorPos!=s&&(i._clearSelector(),i.selectorPos=s,i._setSelector())})),h.observeClick((function(){window.location=e.url})),a++,h})),this.suggestionList.observeEvent("mouseout",(function(){i._clearSelector(),i.selectorPos=-1})),this.totalNumber.set(o)},_hideSuggestions(){this.container.remove(this.suggestionBox),this.suggestionBox=null,this.selectorPos=-1,this.suggestions=null},_retrieveOptions(e){const t=this;this.querying=!0,$.ajax({url:t.searchUrl,type:"GET",data:{term:e},dataType:"json",complete(){t.querying=!1,t.timeOfLastQuery=(new Date).getTime()},success(s){if(handleAjaxError(s))return;s.results.length?(t.suggestions=s.results,t._showSuggestions(e,s.results,s.count-s.results.length)):t._hideSuggestions();const o=trim(t.get());o!=e&&o.length>1?t._textTyped():o.length<=1&&t._hideSuggestions()}})},_getTimeSinceLastQuery(){return(new Date).getTime()-this.timeOfLastQuery},_waitForRequestTime(){const e=this;this.queuedRequest&&(this._getTimeSinceLastQuery()>1e3?(this._textTyped(),this.queuedRequest=!1):setTimeout((function(){e._waitForRequestTime()}),300))},_textTyped(e){const t=this,s=trim(this.get());s.length>1?!this.querying&&this._getTimeSinceLastQuery()>1e3?this._retrieveOptions(s):this.queuedRequest||(this.queuedRequest=!0,setTimeout((function(){t._waitForRequestTime()}),300)):this.suggestionBox&&this._hideSuggestions()},_openSelection(e){return!(this.selectorPos>=0)||(window.location=this.suggestions[this.selectorPos].url,!1)},_moveSelector(e){if(this.suggestionBox){const t=this.suggestionList.length.get();this.selectorPos<0?this.selectorPos="down"==e?0:t-1:(this._clearSelector(),this.selectorPos+="up"==e?-1:1,(this.selectorPos>=t||this.selectorPos<0)&&(this.selectorPos=-1))}this._setSelector()},_setSelector(){this.selectorPos>=0&&(this.suggestionList.item(this.selectorPos).dom.className="selected")},_clearSelector(){this.selectorPos>=0&&(this.suggestionList.item(this.selectorPos).dom.className="")},isAnyItemSelected(){return this.selectorPos>0}},(function(e,t,s){e.autocomplete="off",this.RealtimeTextBox(e),this.selectorPos=-1,this.querying=!1,this.container=t,this.timeOfLastQuery=0,this.searchUrl=s;const o=this;this.observe((function(e,t){return o._textTyped(e),!0})),this.observeOtherKeys((function(e,t,s){return 38==t||40==t?(o._moveSelector(38==t?"up":"down"),!1):27==t?(o._hideSuggestions(),!1):13!=t||o._openSelection(s)})),$E(document.body).observeClick((function(e){o.suggestionBox&&!o.suggestionList.ancestorOf($E(eventTarget(e)))&&$E(eventTarget(e))!=o.input&&o._hideSuggestions()}))})),$.widget("indico.search_tag",{options:{categ_title:"Home",everywhere:!0,search_category_url:"#",search_url:"#",form:null},_transition(e,t){const s=this.$tag;s.fadeTo("fast",.3).find(".where").html(e),s.fadeTo("fast",.5)},_create(){const e=this,s=_.template('<div class="search-tag"><div class="where"><%= categ_title %></div><div class="cross">x</div></div>'),o=this.$tag=$(s({categ_title:this.options.everywhere?t.gettext("Everywhere"):this.options.categ_title}));$(this.element).replaceWith(o);const i=$(".where",o);this.options.everywhere?(o.addClass("everywhere"),$(".cross",this.$tag).hide()):(o.addClass("in-category"),$(".cross",this.$tag).show()),$(".cross",o).on("click",(function(){e.search_everywhere()}));const r=o.parent();r.on("mouseenter",".search-tag.everywhere",(function(){e.show_categ()})),r.on("mouseover",".search-tag.everywhere",(function(t){e.show_tip(t)})),r.on("mouseleave",".search-tag.everywhere",(function(){i.removeData("hasFocus")})),r.on("click",".search-tag.in-category-over",(function(){e.confirm_tip()})),r.on("mouseleave",".search-tag.in-category-over",(function(){e.back_to_everywhere()}))},confirm_tip(){const e=$(".where",this.$tag),t=this.$tag;t.qtip("destroy"),e.fadeOut("fast",(function(){$(this).fadeIn("fast")})),this.$tag.addClass("in-category").removeClass("everywhere").removeClass("in-category-over"),this.options.form.attr("action",this.options.search_category_url),t.animate(200,"swing",(function(){$(".cross",t).fadeIn("fast")}))},search_everywhere(){$(".cross",this.$tag).hide(),this.$tag.addClass("everywhere").removeClass("in-category"),this._transition(t.gettext("Everywhere"),!0),this.options.form.attr("action",this.options.search_url)},show_categ(){const e=this.$tag,t=$(".where",e),s=this;t.data("hasFocus",!0),setTimeout((function(){t.data("hasFocus")&&(s._transition(s.options.categ_title),e.addClass("in-category-over"))}),200)},show_tip(e){this.$tag.qtip({content:format(t.gettext('Click to search inside <span class="label">{title}</span>'),{title:this.options.categ_title}),position:{at:"bottom center",my:"top center"},show:{event:e.type,ready:!0}},e)},back_to_everywhere(){const e=$(".where",this.$tag),s=this;this.$tag.removeClass("in-category-over"),e.removeData("hasFocus"),setTimeout((function(){e.data("hasFocus")||(s._transition(t.gettext("Everywhere"),!0),s.$tag.addClass("everywhere"))}),200)}}),e.categorySearchBox=function(e){const t=$("#category-search-form"),s=t.find(".extra-options"),o=t.find(".search-controls");let i=!1;function r(){const e=$("#search-start_date").val(),t=$("#search-end_date").val();return(!e||Util.parseDateTime(e,IndicoDateTimeFormats.DefaultHourless))&&(!t||Util.parseDateTime(t,IndicoDateTimeFormats.DefaultHourless))}$("#category-search-expand").on("click",(function(){s.is(":visible")?s.slideUp("fast"):(s.slideDown("fast"),i||(i=!0,s.css("display","table").position({of:o,my:"right top",at:"right bottom"})))}));const n=new IntelligentSearchBox({name:"search-phrase",id:"search-phrase",style:{backgroundColor:"transparent",outline:"none"}},$E("category-search-box"),e.categoryNamesUrl);$E("search-phrase").replaceWith(n.draw()),$(".search-button").on("click",(function(){r()&&$("#category-search-form").submit()})),$("#search-phrase").on("keypress",(function(e){13!=e.which||n.isAnyItemSelected()||r()&&$("#category-search-form").submit()})),e.isRoot||($("#category-search-form .search-button").before($('<div class="search-tag">')),$(".search-tag").search_tag({everywhere:!0,categ_title:e.categoryName,form:$("#category-search-form"),search_url:e.searchUrl,search_category_url:e.searchCategoryUrl}))}}(window)},function(e,t,s){}]);
//# sourceMappingURL=main.a637af60.bundle.js.map