(self.webpackJsonp=self.webpackJsonp||[]).push([[205],{218:function(e,t,i){"use strict";var r=i(9);t.a=Object(r.a)(e=>class extends e{static get properties(){return{hass:Object,localize:{type:Function,computed:"__computeLocalize(hass.localize)"}}}__computeLocalize(e){return e}})},241:function(e,t,i){"use strict";i(47);var r=i(53);const n=document.createElement("template");n.setAttribute("style","display: none;"),n.innerHTML=`<dom-module id="ha-style">\n  <template>\n    <style>\n    ${r.c.cssText}\n    </style>\n  </template>\n</dom-module>`,document.head.appendChild(n.content)},869:function(e,t,i){"use strict";i.r(t);i(161);var r=i(4),n=i(32),o=i(607),s=i(0),a=i(12),l=i(608);const d="\nMax Login attempts reached! If you want to use this terminal, please contact an administrator.\n";var c;!function(e){e.Abort="ssh/abort",e.Connect="ssh/connect",e.Command="ssh/send_command",e.Char="ssh/write_char"}(c||(c={}));const h=(e,t)=>e.callWS({type:c.Connect,password:t}),u=(e,t)=>e.callWS({type:c.Command,command:t.command});function p(e){var t,i=_(e.key);"method"===e.kind?t={value:e.value,writable:!0,configurable:!0,enumerable:!1}:"get"===e.kind?t={get:e.value,configurable:!0,enumerable:!1}:"set"===e.kind?t={set:e.value,configurable:!0,enumerable:!1}:"field"===e.kind&&(t={configurable:!0,writable:!0,enumerable:!0});var r={kind:"field"===e.kind?"field":"method",key:i,placement:e.static?"static":"field"===e.kind?"own":"prototype",descriptor:t};return e.decorators&&(r.decorators=e.decorators),"field"===e.kind&&(r.initializer=e.value),r}function m(e,t){void 0!==e.descriptor.get?t.descriptor.get=e.descriptor.get:t.descriptor.set=e.descriptor.set}function f(e){return e.decorators&&e.decorators.length}function v(e){return void 0!==e&&!(void 0===e.value&&void 0===e.writable)}function y(e,t){var i=e[t];if(void 0!==i&&"function"!=typeof i)throw new TypeError("Expected '"+t+"' to be a function");return i}function _(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function g(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function k(e,t,i){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(r){var n=Object.getOwnPropertyDescriptor(r,t);return n.get?n.get.call(i):n.value}})(e,t,i||e)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}const w=/[\x1B]\[[^m]+m/gi;!function(e,t,i,r){var n=function(){(function(){return e});var e={elementsDefinitionOrder:[["method"],["field"]],initializeInstanceElements:function(e,t){["method","field"].forEach((function(i){t.forEach((function(t){t.kind===i&&"own"===t.placement&&this.defineClassElement(e,t)}),this)}),this)},initializeClassElements:function(e,t){var i=e.prototype;["method","field"].forEach((function(r){t.forEach((function(t){var n=t.placement;if(t.kind===r&&("static"===n||"prototype"===n)){var o="static"===n?e:i;this.defineClassElement(o,t)}}),this)}),this)},defineClassElement:function(e,t){var i=t.descriptor;if("field"===t.kind){var r=t.initializer;i={enumerable:i.enumerable,writable:i.writable,configurable:i.configurable,value:void 0===r?void 0:r.call(e)}}Object.defineProperty(e,t.key,i)},decorateClass:function(e,t){var i=[],r=[],n={static:[],prototype:[],own:[]};if(e.forEach((function(e){this.addElementPlacement(e,n)}),this),e.forEach((function(e){if(!f(e))return i.push(e);var t=this.decorateElement(e,n);i.push(t.element),i.push.apply(i,t.extras),r.push.apply(r,t.finishers)}),this),!t)return{elements:i,finishers:r};var o=this.decorateConstructor(i,t);return r.push.apply(r,o.finishers),o.finishers=r,o},addElementPlacement:function(e,t,i){var r=t[e.placement];if(!i&&-1!==r.indexOf(e.key))throw new TypeError("Duplicated element ("+e.key+")");r.push(e.key)},decorateElement:function(e,t){for(var i=[],r=[],n=e.decorators,o=n.length-1;o>=0;o--){var s=t[e.placement];s.splice(s.indexOf(e.key),1);var a=this.fromElementDescriptor(e),l=this.toElementFinisherExtras((0,n[o])(a)||a);e=l.element,this.addElementPlacement(e,t),l.finisher&&r.push(l.finisher);var d=l.extras;if(d){for(var c=0;c<d.length;c++)this.addElementPlacement(d[c],t);i.push.apply(i,d)}}return{element:e,finishers:r,extras:i}},decorateConstructor:function(e,t){for(var i=[],r=t.length-1;r>=0;r--){var n=this.fromClassDescriptor(e),o=this.toClassDescriptor((0,t[r])(n)||n);if(void 0!==o.finisher&&i.push(o.finisher),void 0!==o.elements){e=o.elements;for(var s=0;s<e.length-1;s++)for(var a=s+1;a<e.length;a++)if(e[s].key===e[a].key&&e[s].placement===e[a].placement)throw new TypeError("Duplicated element ("+e[s].key+")")}}return{elements:e,finishers:i}},fromElementDescriptor:function(e){var t={kind:e.kind,key:e.key,placement:e.placement,descriptor:e.descriptor};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),"field"===e.kind&&(t.initializer=e.initializer),t},toElementDescriptors:function(e){var t;if(void 0!==e)return(t=e,function(e){if(Array.isArray(e))return e}(t)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return g(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?g(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).map((function(e){var t=this.toElementDescriptor(e);return this.disallowProperty(e,"finisher","An element descriptor"),this.disallowProperty(e,"extras","An element descriptor"),t}),this)},toElementDescriptor:function(e){var t=String(e.kind);if("method"!==t&&"field"!==t)throw new TypeError('An element descriptor\'s .kind property must be either "method" or "field", but a decorator created an element descriptor with .kind "'+t+'"');var i=_(e.key),r=String(e.placement);if("static"!==r&&"prototype"!==r&&"own"!==r)throw new TypeError('An element descriptor\'s .placement property must be one of "static", "prototype" or "own", but a decorator created an element descriptor with .placement "'+r+'"');var n=e.descriptor;this.disallowProperty(e,"elements","An element descriptor");var o={kind:t,key:i,placement:r,descriptor:Object.assign({},n)};return"field"!==t?this.disallowProperty(e,"initializer","A method descriptor"):(this.disallowProperty(n,"get","The property descriptor of a field descriptor"),this.disallowProperty(n,"set","The property descriptor of a field descriptor"),this.disallowProperty(n,"value","The property descriptor of a field descriptor"),o.initializer=e.initializer),o},toElementFinisherExtras:function(e){return{element:this.toElementDescriptor(e),finisher:y(e,"finisher"),extras:this.toElementDescriptors(e.extras)}},fromClassDescriptor:function(e){var t={kind:"class",elements:e.map(this.fromElementDescriptor,this)};return Object.defineProperty(t,Symbol.toStringTag,{value:"Descriptor",configurable:!0}),t},toClassDescriptor:function(e){var t=String(e.kind);if("class"!==t)throw new TypeError('A class descriptor\'s .kind property must be "class", but a decorator created a class descriptor with .kind "'+t+'"');this.disallowProperty(e,"key","A class descriptor"),this.disallowProperty(e,"placement","A class descriptor"),this.disallowProperty(e,"descriptor","A class descriptor"),this.disallowProperty(e,"initializer","A class descriptor"),this.disallowProperty(e,"extras","A class descriptor");var i=y(e,"finisher");return{elements:this.toElementDescriptors(e.elements),finisher:i}},runClassFinishers:function(e,t){for(var i=0;i<t.length;i++){var r=(0,t[i])(e);if(void 0!==r){if("function"!=typeof r)throw new TypeError("Finishers must return a constructor.");e=r}}return e},disallowProperty:function(e,t,i){if(void 0!==e[t])throw new TypeError(i+" can't have a ."+t+" property.")}};return e}();if(r)for(var o=0;o<r.length;o++)n=r[o](n);var s=t((function(e){n.initializeInstanceElements(e,a.elements)}),i),a=n.decorateClass(function(e){for(var t=[],i=function(e){return"method"===e.kind&&e.key===o.key&&e.placement===o.placement},r=0;r<e.length;r++){var n,o=e[r];if("method"===o.kind&&(n=t.find(i)))if(v(o.descriptor)||v(n.descriptor)){if(f(o)||f(n))throw new ReferenceError("Duplicated methods ("+o.key+") can't be decorated.");n.descriptor=o.descriptor}else{if(f(o)){if(f(n))throw new ReferenceError("Decorators can't be placed on different accessors with for the same property ("+o.key+").");n.decorators=o.decorators}m(o,n)}else t.push(o)}return t}(s.d.map(p)),e);n.initializeClassElements(s.F,a.elements),n.runClassFinishers(s.F,a.finishers)}([Object(s.d)("ha-terminal")],(function(e,t){class i extends t{constructor(...t){super(...t),e(this)}}return{F:i,d:[{kind:"field",key:"terminal",value:void 0},{kind:"field",decorators:[Object(s.h)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[Object(s.h)()],key:"loggedIn",value:void 0},{kind:"field",decorators:[Object(s.h)()],key:"loginAttempts",value:()=>0},{kind:"field",decorators:[Object(s.h)()],key:"rendering",value:()=>!0},{kind:"field",decorators:[Object(s.h)()],key:"error",value:()=>!1},{kind:"field",decorators:[Object(s.h)()],key:"asciiLogo",value:()=>["  ______  _______  ______       _______  ______    ______        ______"," /      ||   ____||   _  \\     |   ____||   _  \\  |   _  \\      /  __  \\","|  ,----'|  |__   |  |_)  |    |  |__   |  |_)  | |  |_)  |    |  |  |  |","|  |     |   __|  |      /     |   __|  |   _  <  |      /     |  |  |  |","|  `----.|  |____ |  |\\  \\----.|  |____ |  |_)  | |  |\\  \\----.|  `--'  |"," \\______||_______|| _| `._____||_______||______/  | _| `._____| \\______/"]},{kind:"field",decorators:[Object(s.h)()],key:"fixedTextLength",value:()=>0},{kind:"field",decorators:[Object(s.h)()],key:"processing",value:()=>!1},{kind:"field",decorators:[Object(s.h)()],key:"commandHistory",value:()=>[]},{kind:"field",decorators:[Object(s.g)()],key:"lineFeedSource",value:void 0},{kind:"field",decorators:[Object(s.g)()],key:"input",value:()=>""},{kind:"field",decorators:[Object(s.g)()],key:"prevInputPrompt",value:()=>""},{kind:"field",decorators:[Object(s.g)()],key:"isInputHidden",value:()=>!0},{kind:"field",decorators:[Object(s.g)()],key:"hiddenInput",value:()=>""},{kind:"field",decorators:[Object(s.g)()],key:"editorMode",value:()=>!1},{kind:"field",decorators:[Object(s.g)()],key:"loginMessage",value:()=>"To continue please log in to [1m[38;2;99;92;191mcerebro[0m: "},{kind:"method",key:"connectedCallback",value:function(){if(k(b(i.prototype),"connectedCallback",this).call(this),!this.terminal){const e={cursorBlink:!0,cursorStyle:"block",cols:86,rows:25};this.terminal=new o.Terminal(e)}this.autofocus&&this.terminal.focus()}},{kind:"method",key:"update",value:function(e){k(b(i.prototype),"update",this).call(this,e),e.has("rendering")&&this.classList.toggle("rendering-state",this.rendering),e.has("error")&&this.classList.toggle("error-state",this.error)}},{kind:"method",key:"firstUpdated",value:function(e){k(b(i.prototype),"firstUpdated",this).call(this,e),this._load()}},{kind:"method",key:"_load",value:async function(){var e,t;this.attachShadow({mode:"open"}).innerHTML=`\n      <style>\n        ${l.a}\n\n        :host(.rendering-state) {\n          display: none;\n        }\n\n        :host(.error-state) {\n          border-color: var(--error-state-color, red);\n          display: none;\n        }\n      </style>\n    `;let i=document.createElement("div");i.setAttribute("id","terminal"),null===(e=this.shadowRoot)||void 0===e||e.appendChild(i),this.terminal&&(this.terminal.open(i),this._printWelcome(),null===(t=this.terminal)||void 0===t||t.write("[5m"),this.terminal.onLineFeed(()=>this._onLineFeed()),this.terminal.onKey(e=>this._onKey(e.key,e.domEvent)),this.hass.connection.subscribeEvents(e=>this._printStdout(e),"ssh_stdout_ready"),this.hass.connection.subscribeEvents(e=>this._commandInput(e.data),"ssh_process_input"),this.hass.connection.subscribeEvents(e=>{this.editorMode=e.data.editMode,this.isInputHidden=!1,this.input=this.hiddenInput=""},"ssh_edit_mode"),this.hass.connection.subscribeEvents(()=>{var e;this.loggedIn=!1,this.isInputHidden=!0,null===(e=this.terminal)||void 0===e||e.write("c"),this._printWelcome()},"ssh_exit"))}},{kind:"method",key:"_printWelcome",value:function(){var e,t,i,r,n,o;null===(e=this.terminal)||void 0===e||e.writeln(""),this.asciiLogo.forEach(e=>{var t;null===(t=this.terminal)||void 0===t||t.writeln(e)}),null===(t=this.terminal)||void 0===t||t.writeln(""),null===(i=this.terminal)||void 0===i||i.writeln(""),null===(r=this.terminal)||void 0===r||r.writeln("Welcome to the Cerebro ssh terminal!"),null===(n=this.terminal)||void 0===n||n.writeln(""),null===(o=this.terminal)||void 0===o||o.write(this.loginMessage),this.prevInputPrompt=this.loginMessage,this.fixedTextLength=this._getTextLength(this.loginMessage)}},{kind:"method",key:"_getTextLength",value:function(e){return(e=(e=(e=e.split("\n").slice(-1)[0]).split("").slice(-1)[0]).replace(w,"")).length}},{kind:"method",key:"_isWriteable",value:function(e){return 32==e||48<=e&&e<=90||96<=e&&e<=111||186<=e&&e<=222}},{kind:"method",key:"_handleMetaKeys",value:function(e,t,i){if(e&&65<=i&&i<=90){let e=i-64;u(this.hass,{command:String.fromCharCode(e),isExecuting:this.processing,startTime:new Date})}}},{kind:"method",key:"_logIn",value:async function(e,t){var i,r;if(null===(i=this.terminal)||void 0===i||i.write(`[${t+1};0H`),!e)return null===(r=this.terminal)||void 0===r||r.write(this.prevInputPrompt),void(this.fixedTextLength=this._getTextLength(this.prevInputPrompt));h(this.hass,e).then(e=>{e.finishTime=new Date,this.commandHistory.push(e),this.loggedIn=!0,this.isInputHidden=!1}).catch(()=>{var e,t;this.lineFeedSource="invalid_auth",null===(e=this.terminal)||void 0===e||e.writeln("[38;2;255;0;0mInvalid auth![0m"),null===(t=this.terminal)||void 0===t||t.write(this.prevInputPrompt),this.fixedTextLength=this._getTextLength(this.prevInputPrompt),this.loginAttempts++,localStorage.setItem("login_attempts",""+this.loginAttempts),console.error("There was a problem Authenticating")})}},{kind:"method",key:"_sendCommand",value:async function(e){Object(a.a)(this,"ssh-command-sent",{command:e}),this.processing=!0;let t={command:e,isExecuting:!0,startTime:new Date};u(this.hass,t).then(e=>{this.commandHistory.length>=20&&this.commandHistory.shift(),this.commandHistory.push(e)}).catch(e=>{console.error(e)})}},{kind:"method",key:"_printStdout",value:function(e){this.terminal&&(this.lineFeedSource=e.data.lineSource,this.processing=e.data.isExecuting,e.data.newLine?(this.terminal.writeln(e.data.resultBuffer),this.fixedTextLength=0):(this.terminal.write(e.data.resultBuffer),this.fixedTextLength=this._getTextLength(e.data.resultBuffer)))}},{kind:"method",key:"_commandInput",value:function(e){this.isInputHidden=e.isHidden,this.input=this.hiddenInput=""}},{kind:"method",key:"_onLineFeed",value:async function(){var e,t;if("input"!==this.lineFeedSource)return;let i=null===(e=this.terminal)||void 0===e?void 0:e.buffer.active.cursorY;if(!i)return;null===(t=this.terminal)||void 0===t||t.write(`[${i};0H`);let r=this.isInputHidden?this.hiddenInput:this.input;var n,o;(this.fixedTextLength=0,this.hiddenInput=this.input="",!this.loggedIn&&this.isInputHidden)&&(this.loginAttempts=+(null!==(n=localStorage.getItem("login_attempts"))&&void 0!==n?n:"0"),this.loginAttempts<5?this._logIn(r,i):(this.lineFeedSource="invalid_auth",null===(o=this.terminal)||void 0===o||o.writeln(d),this.fixedTextLength=this._getTextLength(d)))}},{kind:"method",key:"_onKey",value:function(e,t){let i="";if(8==t.keyCode)this.isInputHidden?this.hiddenInput.length>0&&(this.hiddenInput=this.hiddenInput.substr(0,this.hiddenInput.length-1)):i="\b";else if(13==t.keyCode)this.lineFeedSource="input",i=this.editorMode?"\r":"\n";else if(38==t.keyCode&&this.loggedIn)i="[A";else if(40==t.keyCode&&this.loggedIn)i="[B";else if(39==t.keyCode){var r;let e=this.isInputHidden?"":this.input;(null===(r=this.terminal)||void 0===r?void 0:r.buffer.active.cursorX)<this.fixedTextLength+e.length&&(i="[C")}else if(37==t.keyCode){var n;let e=this.isInputHidden?"":this.input,t=null===(n=this.terminal)||void 0===n?void 0:n.buffer.active.cursorX;e.length>t-this.fixedTextLength&&(i="[D")}else if(this._isWriteable(t.keyCode)){if(t.ctrlKey||t.altKey)return void this._handleMetaKeys(t.ctrlKey,t.altKey,t.keyCode);this.isInputHidden?this.hiddenInput+=e:this.input+=e,this.loggedIn&&(i=e)}else 9==t.keyCode?i="\t":console.log(t.keyCode);var o,s,a;i&&(this.editorMode||this.loggedIn?(s=this.hass,a=i,s.callWS({type:c.Char,char:a})):null===(o=this.terminal)||void 0===o||o.write(i))}}]}}),s.b);var x=i(218);i(241);class E extends(Object(x.a)(n.a)){static get template(){return r.a`
      <style include="ha-style iron-flex iron-positioning"></style>
      <style>
        .content {
          padding: 16px;
          direction: ltr;
        }

        .horizontal {
          max-width: 80%;
        }

        .render-pane {
          position: relative;
          max-width: 50%;
        }

        .whitespace {
          max-width: 80%;
          padding: 0px 20px;
        }

        .render-spinner {
          position: absolute;
          top: 8px;
          right: 8px;
        }

        .rendered {
          @apply --paper-font-code1;
          clear: both;
          white-space: pre-wrap;
        }

        .rendered.error {
          color: red;
        }
      </style>
      <div class$="[[computeFormClasses(narrow)]]">
        <div class="terminal">
          <p>[[localize('ui.panel.developer-tools.tabs.terminal.terminal')]]</p>
          <p>
            [[localize('ui.panel.developer-tools.tabs.terminal.max_login')]]
          </p>
          <mwc-button on-click="_resetLogin" raised>
            [[localize('ui.panel.developer-tools.tabs.terminal.reset_login')]]
          </mwc-button>
          <div class="whitespace"><br /></div>
          <ha-terminal
            rendering="[[rendering]]"
            error="[[error]]"
            hass="[[hass]]"
            loggedIn="[[loggedIn]]"
          />
        </div>

        <div class="render-pane">
          <ha-circular-progress
            class="render-spinner"
            active="[[rendering]]"
            size="small"
          ></ha-circular-progress>
          <br />
          <pre class$="[[computeRenderedClasses(error)]]">[[processed]]</pre>
        </div>
      </div>
    `}static get properties(){return{hass:{type:Object},error:{type:Boolean,value:!1},processed:{type:String,value:""},loggedIn:{type:Boolean,value:!1},rendering:{type:Boolean,value:!0}}}_resetLogin(){localStorage.setItem("login_attempts","0")}ready(){super.ready(),this.renderTemplate()}computeFormClasses(e){return e?"content":"content layout horizontal"}computeRenderedClasses(e){return e?"error rendered":"rendered"}renderTemplate(){this.rendering=!1,h(this.hass,".").then(e=>{console.log("SSH client connected!",e.result),this.processed="SSH client connected!",this.error=!1,this.loggedIn=!0},e=>{"auth"==e.code?(console.log("SSH server exists, please log in"),this.error=!1):(console.error("Failed to connect to host!",e),this.processed=e&&e.body&&e.body.message||this.hass.localize("ui.panel.developer-tools.tabs.terminal.failed_to_connect"),this.error=!0)})}}customElements.define("developer-tools-terminal",E)}}]);
//# sourceMappingURL=chunk.22db93a3097f01e1b520.js.map