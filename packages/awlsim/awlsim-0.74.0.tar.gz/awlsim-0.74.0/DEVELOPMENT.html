<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"></head><body>
<h1>Awlsim development notes</h1>

<h2>Unit tests</h2>

<p>The unit test suite can be run with the invocation of the command <code>./tests/run.sh</code>. This will run all unit tests and show the results.
Please see <code>./tests/run.sh --help</code> for more options.</p>

<h3>Code coverage tracing</h3>

<p>To run a code statement coverage trace during unit testing the option <code>./tests/run.sh --coverage</code> is available. The results will be stored in <code>./code-coverage-report/</code>. It is desired to have a reasonable code coverage of the unit tests. All main code paths should be covered.</p>

<h2>Special annotations in the source code</h2>

<p>In order to support both compiling the Awlsim core with Cython and running the same code in a plain Python interpreter without compilation, a method to patch the files is required. The setup.py scrips patch each .py source file and create a .pyx file before starting Cython compilation. The Cython patching mechanism rewrites all <code>import</code>s to import the compiled Cython modules instead of the plain Python modules. In addition to that some special comments are provided as hint to the Cython patcher:</p>

<ul>
<li><code>#@cy</code> : Enable (un-comment) this line during Cython patching.</li>
<li><code>#@cy-posix</code> : Enable (un-comment) this line during Cython patching, if compiling for a Posix platform.</li>
<li><code>#@cy-win</code> : Enable (un-comment) this line during Cython patching, if compiling for a Windows platform.</li>
<li><code>#@nocy</code> : Disable (comment) this line during Cython patching.</li>
<li><code>#@no-cython-patch</code> : Do not touch this line during cython patching.</li>
<li><code>#+NoneToNULL</code> : Transform all <code>None</code> keywords in this line into <code>NULL</code>.</li>
<li><code>#+cimport</code> : Transform all <code>import</code> keywords in this line into <code>cimport</code>.</li>
<li><code>#+cdef</code> : Add a <code>cdef</code> to this line. For functions or methods that means to change <code>def</code> into <code>cdef</code> in the function signature. For classes that means to change <code>class</code> to <code>cdef class</code>.</li>
<li><code>#+cpdef</code> : Same as <code>#+cdef</code>, but add <code>cpdef</code> instead.</li>
<li><code>#+cdef-foobar-bizz</code> : Same as <code>#+cdef</code>, but also add the additional words <code>foobar bizz</code> after <code>cdef</code>. Arbitrary words may be specified and the number of words is not limited. The dash <code>-</code> will be transformed into a space character.</li>
<li><code>#+likely</code> : Mark an <code>if</code> condition as being likely to evaluate to True. This annotation can only be used in lines with an <code>if</code> statement. It helps the C compiler to generate better machine code.</li>
<li><code>#+unlikely</code> : Mark an <code>if</code> condition as being unlikely to evaluate to True. This annotation can only be used in lines with an <code>if</code> statement. It helps the C compiler to generate better machine code.</li>
<li><code>#+suffix-u</code> : Add an <code>u</code> suffix to all decimal and hexadecimal immediates in the line.</li>
<li><code>#+suffix-LL</code> : Add an <code>L</code> suffix to all decimal and hexadecimal immediates in the line.</li>
</ul>

<p>To disable code coverage tracing an additional special comment is provided:</p>

<ul>
<li><code>#@nocov</code> : This excludes the line from Python <code>coverage</code> tracing.</li>
</ul>
</body></html>
