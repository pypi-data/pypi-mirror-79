<div id="pyprofibus-fpga-phy-documentation">
<h2>pyprofibus FPGA PHY documentation</h2>
<p>Instead of using the serial port of the host computer to connect to the Profibus network an FPGA can be used. That improves the realtime capabilities and the speed of the pyprofibus system.</p>
</div>
<div id="fpga-boards">
<h2>FPGA boards</h2>
<p>Currently only the <a href="https://tinyfpga.com/" rel="nofollow">TinyFPGA BX</a> is supported as FPGA.</p>
<p>However it’s possible to add support for other FPGAs. The TinyFPGA BX has been chosen, because it has a fully Open Source toolchain. So the pyprofibus FPGA Verilog sources can be translated to the binary FPGA bitstream using only freely available tools.</p>
<p>The pyprofibus releases come with pre-built bitstream images. So there’s no need for the user to install the toolchain and build the FPGA bitstream. The only tool that is needed is the “flashing/programming tool” that is used to transfer the binary bitstream to the FPGA board.</p>
<div id="flashing-programming-tool">
<h3>Flashing / Programming tool</h3>
<p>For the purpose of writing/downloading/flashing the binary FPGA bitstream to the TinyFPGA BX board the <a href="https://github.com/tinyfpga/TinyFPGA-Bootloader/" rel="nofollow">tinyprog</a> tool can be used.</p>
<p>The helper script <cite>tinyfpga_bx_program.sh</cite> shipped with pyprofibus in the subdirectory <cite>phy_fpga/bin/tinyfpga_bx</cite> can be used to conveniently call <cite>tinyprog</cite> with the correct parameters. Just connect the TinyFPGA BX board via USB to the computer and run the <cite>tinyfpga_bx_program.sh</cite> script. It does everything to program the pyprofibus PHY to your TinyFPGA BX.</p>
</div>
<div id="build-toolchain">
<h3>Build toolchain</h3>
<p>If you want to modify the FPGA sources and build your own version of the FPGA bitstream, the following tools are required:</p>
<div id="project-icestorm">
<h4>Project IceStorm</h4>
<p>The <a href="http://www.clifford.at/icestorm/" rel="nofollow">Project IceStorm</a> is needed to build the bitstream for the TinyFPGA BX board.</p>
</div>
<div id="yosys">
<h4>Yosys</h4>
<p>The <a href="http://www.clifford.at/yosys/" rel="nofollow">Yosys Open SYnthesis Suite</a> is required to synthesize the Verilog sources.</p>
</div>
<div id="nextpnr">
<h4>nextpnr</h4>
<p>The <a href="https://github.com/YosysHQ/nextpnr" rel="nofollow">nextpnr FPGA place and route tool</a> is required for FPGA routing.</p>
</div>
<div id="python">
<h4>Python</h4>
<p><a href="https://www.python.org/" rel="nofollow">Python 3.7</a> or later is required to auto-generate some parts of the sources.</p>
</div>
<div id="gnu-make-an-other-standard-gnu-linux-shell-utilities">
<h4>GNU make an other standard GNU/Linux shell utilities</h4>
<p><a href="https://www.gnu.org/software/make/" rel="nofollow">GNU make</a> and various other standard GNU/Linux shell utilities, that are already installed on any Desktop Linux distribution. Building on Windows is not supported.</p>
</div>
</div>
<div id="downloading-and-installing-all-toolchain-tools">
<h3>Downloading and installing all toolchain tools</h3>
<p>The script <cite>build_fpga_toolchain.sh</cite> that is included in the pyprofibus archive can be used to download, build and install all FPGA toolchain tools to the <cite>$HOME</cite> directory.</p>
<p>Just run the script as follows. It will download all required packages, build and install everything to <cite>$HOME/fpga-toolchain</cite> by default.</p>
<pre><span class="nb">cd</span> phy_fpga/fpgamakelib
./build_fpga_toolchain.sh
</pre>
<p>After successful execution of <cite>build_fpga_toolchain.sh</cite> please read the information about <cite>$PATH</cite> that the script prints to the console. The line printed by the script shall be added to your <cite>$HOME/.bashrc</cite></p>
<p>No changes to the operating system are necessary. Do <em>not</em> run <cite>build_fpga_toolchain.sh</cite> as root.</p>
<p>The toolchain can be uninstalled by simply deleting the directory <cite>$HOME/fpga-toolchain</cite></p>
</div>
<div id="building-pyprofibus-phy-fpga">
<h3>Building pyprofibus PHY-FPGA</h3>
<p>To build the PHY-FPGA sources run the following commands:</p>
<pre><span class="nb">cd</span> phy_fpga
make clean
make
</pre>
</div>
</div>

