import{useCallback as u,useEffect as g,useLayoutEffect as b,useRef as s,useState as y}from"../../web_modules/react.js";import{maskColor as w,position as C,primaryColor as j,size as x,textColor as E}from"../utils/style.js";import{dataURL2Blob as L}from"../utils/image.js";import{saveAs as k}from"../../web_modules/file-saver.js";import z from"../../web_modules/styled-components.js";const A=l=>{const i=s(null),r=s(null),[n,c]=y(null),d=s(l.onInit),v=s(l.onDispose),a=u(()=>{var e;return(e=r.current)===null||e===void 0?void 0:e.dispatchAction({type:"hideTip"})},[]),m=u(()=>{(async()=>{const{default:e}=await import("../../web_modules/echarts.js");if(l.gl&&await import("../../web_modules/echarts-gl.js"),!i.current)return;r.current=e.init(i.current),i.current.addEventListener("mouseleave",a),setTimeout(()=>{if(l.zoom){var t;(t=r.current)===null||t===void 0||t.dispatchAction({type:"takeGlobalCursor",key:"dataZoomSelect",dataZoomSelectActive:!0})}if(r.current){var o;(o=d.current)===null||o===void 0||o.call(d,r.current)}},0),c(r.current)})()},[l.gl,l.zoom,a]),f=u(()=>{var e,t;if(r.current){var o;(o=v.current)===null||o===void 0||o.call(v,r.current)}(e=r.current)===null||e===void 0||e.dispose(),(t=i.current)===null||t===void 0||t.removeEventListener("mouseleave",a),c(null)},[a]);g(()=>(m(),f),[m,f]),g(()=>{if(l.loading){var e;(e=r.current)===null||e===void 0||e.showLoading("default",{text:"",color:j,textColor:E,maskColor:w,zlevel:0})}else{var t;(t=r.current)===null||t===void 0||t.hideLoading()}},[l.loading]);const p=s(null);b(()=>{if(l.autoFit){const e=p.current;if(e){const t=new ResizeObserver(()=>{var o;(o=r.current)===null||o===void 0||o.resize()});return t.observe(e),()=>t.unobserve(e)}}},[l.autoFit]);const h=u(e=>{if(n){const t=L(n.getDataURL({type:"png",pixelRatio:2,backgroundColor:"#FFF"}));k(t,`${(e==null?void 0:e.replace(/[/\\?%*:|"<>]/g,"_"))||"chart"}.png`)}},[n]);return{ref:i,echart:n,wrapper:p,saveAsImage:h}};export default A;export const Wrapper=z.div.withConfig({displayName:"useECharts__Wrapper",componentId:"b4c6ck-0"})(["position:relative;display:flex;justify-content:center;align-items:stretch;> .echarts{width:100%;}> .loading{"," "," display:flex;justify-content:center;align-items:center;}"],x("100%"),C("absolute",0,null,null,0));
