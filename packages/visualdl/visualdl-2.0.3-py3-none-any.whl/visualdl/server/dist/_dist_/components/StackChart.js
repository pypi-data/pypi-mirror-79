function ce(t,l){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);l&&(s=s.filter(function(d){return Object.getOwnPropertyDescriptor(t,d).enumerable})),r.push.apply(r,s)}return r}function de(t){for(var l=1;l<arguments.length;l++){var r=arguments[l]!=null?arguments[l]:{};l%2?ce(Object(r),!0).forEach(function(s){je(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ce(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function je(t,l,r){return l in t?Object.defineProperty(t,l,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[l]=r,t}function pe(t,l){if(t==null)return{};var r=_e(t,l),s,d;if(Object.getOwnPropertySymbols){var y=Object.getOwnPropertySymbols(t);for(d=0;d<y.length;d++){if(s=y[d],l.indexOf(s)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(t,s))continue;r[s]=t[s]}}return r}function _e(t,l){if(t==null)return{};var r={},s=Object.keys(t),d,y;for(y=0;y<s.length;y++){if(d=s[y],l.indexOf(d)>=0)continue;r[d]=t[d]}return r}import*as A from"../utils/chart.js";import R,{useCallback as b,useEffect as S,useImperativeHandle as we,useMemo as B,useRef as J,useState as Q}from"../../web_modules/react.js";import{primaryColor as Oe}from"../utils/style.js";import Ee,{Wrapper as Re}from"../hooks/useECharts.js";import ke from"../../web_modules/react-spinners/GridLoader.js";import ze from"../../web_modules/lodash/defaultsDeep.js";import De from"../../web_modules/styled-components.js";import Ie from"../hooks/useThrottleFn.js";const Le=De.div.withConfig({displayName:"StackChart__Tooltip",componentId:"sc-1xrpgve-0"})(["position:absolute;z-index:1;background-color:rgba(0,0,0,0.75);color:#fff;border-radius:4px;padding:5px;display:none;"]),Se=R.forwardRef(({options:t,data:l,title:r,loading:s,zoom:d,className:y,onInit:T},fe)=>{var F,X;const V=l??{minZ:0,maxZ:0,minY:0,maxY:0,minX:0,maxX:0,data:null},{minZ:C,maxZ:$,minY:h,maxY:P,minX:ee,maxX:te}=V,ne=pe(V,["minZ","maxZ","minY","maxY","minX","maxX"]),j=B(()=>{var e;return(e=ne.data)!==null&&e!==void 0?e:[]},[ne.data]),_=B(()=>h===0&&P===0?-.4:h-(P-h)*.4,[h,P]),w=b((e,n,o,a)=>{const i=a([e,n]);return i?(i[1]-=(o-C)/($-C)*(a([0,h])[1]-a([0,_])[1]),i):[0,0]},[C,$,h,_]),Y=b((e,n,o)=>{const a=[];let i=0;for(;j[e]&&i<j[e].length;){const u=n(i++),v=n(i++),m=n(i++);m!==1&&i===3&&a.push(w(u,v,1,o)),a.push(w(u,v,m,o)),m!==1&&i===j[e].length&&a.push(w(u,v,1,o))}return a},[w,j]),ie=b((e,n)=>{const o=Y(e.dataIndex,n.value,n.coord);return{type:"polygon",silent:!0,z:n.value(1),shape:{points:o},style:n.style({stroke:A.xAxis.axisLine.lineStyle.color,lineWidth:1})}},[Y]),[g,re]=Q(null),[O,U]=Q([]),x=J(null),[me,oe]=Q(""),W=J(g),le=J(O);S(()=>{W.current=g},[g]),S(()=>{le.current=O},[O]);const k=t==null||((F=t.axisPointer)===null||F===void 0||((X=F.label)===null||X===void 0))?void 0:X.formatter,se=b(e=>!k||W.current==null?"":typeof k=="string"?k:k(e,le.current[W.current]),[k]),f=B(()=>{const{color:e,colorAlt:n,toolbox:o,series:a}=A,i=pe(A,["color","colorAlt","toolbox","series"]);return ze({title:{text:r??""},visualMap:{min:h,max:P},axisPointer:{label:{formatter:se}},xAxis:{min:ee,max:te,axisPointer:{type:"none"}},yAxis:{inverse:!0,position:"right",min:_,max:P,axisLine:{onZero:!1},axisLabel:{formatter:u=>u<h?"":u+""},axisPointer:{type:"none"}},grid:{left:i.grid.right,right:i.grid.left},tooltip:{trigger:"none",showContent:!1,axisPointer:{axis:"y",snap:!1}},series:[de(de({},a),{},{type:"custom",silent:!0,data:j,renderItem:ie})]},t,i)},[t,r,j,ee,te,h,P,_,ie,se]),z=b(()=>{var e;re(null),U([]),((e=f.tooltip)===null||e===void 0?void 0:e.formatter)&&(oe(""),x.current&&(x.current.style.display="none"))},[f.tooltip]),ve=b((e,n)=>{try{var o,a,i,u;if(!e||!n)return;const{offsetX:E,offsetY:M}=n;if((o=M<_+f.grid.top)!==null&&o!==void 0?o:0){z();return}const[be,Pe]=e.convertFromPixel("grid",[E,M]),H=(a=(i=e.getOption().series)===null||i===void 0?void 0:i[0].data)!==null&&a!==void 0?a:[],G=H.map(p=>p[1]).sort((p,I)=>p-I);let K=0,D=null;for(;K<G.length;)if(Pe<=G[K++]){D=G[K-1];break}const q=D==null?null:H.findIndex(p=>p[1]===D);re(q);let Z=[];if(D==null||(Z=H.map(p=>{const I=[p[0],p[1],p[2]];let ae=Number.POSITIVE_INFINITY;for(let L=0;L<p.length;L+=3){const ue=Math.abs(p[L]-be);ue<ae&&(ae=ue,I[0]=p[L],I[2]=p[L+2])}return I})),U(Z),(u=f.tooltip)===null||u===void 0?void 0:u.formatter){var v,m;oe(q==null?"":(v=f.tooltip)===null||v===void 0||((m=v.formatter)===null||m===void 0)?void 0:m.call(v,Z[q])),x.current&&(D==null?x.current.style.display="none":(x.current.style.left=`${E+10}px`,x.current.style.top=`${M+10}px`,x.current.style.display="block"))}}catch(E){z()}},[z,_,f.grid,f.tooltip]),N=Ie(ve,{wait:200}),ye=b(e=>{try{const n=e.getZr();n&&(n.on("mousemove",o=>N.run(e,o)),n.on("mouseout",()=>{N.cancel(),z()}))}catch(n){N.cancel()}T==null||T(e)},[T,N,z]),{ref:he,echart:c,wrapper:xe,saveAsImage:ge}=Ee({loading:!!s,zoom:d,autoFit:!0,onInit:ye});return we(fe,()=>({saveAsImage:()=>{ge(r)}})),S(()=>{c==null||c.setOption(f,{notMerge:!0})},[c,f]),S(()=>{if(c)try{if(g==null)c.setOption({graphic:{elements:[{id:"highlight",type:"polyline",$action:"remove"}]}});else{var e,n;const o=(e=(n=c.getOption().series)===null||n===void 0?void 0:n[0].data)!==null&&e!==void 0?e:[],a=u=>c.convertToPixel("grid",u),i=u=>o[g][u];c.setOption({graphic:{elements:[{id:"highlight",type:"polyline",$action:"replace",silent:!0,cursor:"default",zlevel:1,z:1,shape:{points:Y(g,i,a)}}]}})}}catch(o){}},[g,c,Y]),S(()=>{if(c)try{if(O.length){const i=u=>c.convertToPixel("grid",u);c.setOption({graphic:{elements:O.map((u,v)=>{var m;const E=w(u[0],u[1],u[2],i);return{type:"circle",id:`dot${v}`,$action:"replace",cursor:"default",zlevel:1,z:2,shape:{cx:E[0],cy:E[1],r:3},style:{fill:"#fff",stroke:(m=f.color)===null||m===void 0?void 0:m[0],lineWidth:2}}})}})}else{var e,n,o,a;c.setOption({graphic:{elements:(e=c.getOption())===null||e===void 0||((n=e.graphic)===null||n===void 0||((o=n[0])===null||o===void 0||((a=o.elements)===null||a===void 0)))?void 0:a.filter(i=>i.id.startsWith("dot")).map(i=>({id:i.id,type:"circle",$action:"remove"}))}})}}catch(i){}},[O,c,f.color,w]),R.createElement(Re,{ref:xe,className:y},!c&&R.createElement("div",{className:"loading"},R.createElement(ke,{color:Oe,size:"10px"})),R.createElement("div",{className:"echarts",ref:he}),R.createElement(Le,{className:"tooltip",ref:x,dangerouslySetInnerHTML:{__html:me}}))});export default Se;
