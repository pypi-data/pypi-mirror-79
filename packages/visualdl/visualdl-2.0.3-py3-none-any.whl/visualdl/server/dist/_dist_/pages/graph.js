import j,{AsideSection as s}from"../components/Aside.js";import se from"../components/GraphPage/Graph.js";import e,{useCallback as i,useEffect as H,useMemo as x,useRef as q,useState as r}from"../../web_modules/react.js";import ie from"../components/Select.js";import{primaryColor as ce,rem as c,size as _e}from"../utils/style.js";import y from"../components/Button.js";import G from"../components/Checkbox.js";import me from"../components/Content.js";import f from"../components/Field.js";import pe from"../../web_modules/react-spinners/HashLoader.js";import ue from"../components/GraphPage/ModelPropertiesDialog.js";import de from"../components/GraphPage/NodeDocumentationSidebar.js";import he from"../components/GraphPage/NodePropertiesSidebar.js";import J from"../components/RadioButton.js";import Ee from"../components/RadioGroup.js";import ge from"../components/GraphPage/Search.js";import fe from"../components/Title.js";import Pe from"../components/GraphPage/Uploader.js";import _ from"../../web_modules/styled-components.js";import Re from"../hooks/useGlobalState.js";import ve from"../hooks/useRequest.js";import{useTranslation as Ue}from"../../web_modules/react-i18next.js";const K=_(y).withConfig({displayName:"graph__FullWidthButton",componentId:"sc-1v5tw03-0"})(["width:100%;"]),we=_(ie).withConfig({displayName:"graph__FullWidthSelect",componentId:"sc-1v5tw03-1"})(["width:100%;"]),Se=_.div.withConfig({displayName:"graph__ExportButtonWrapper",componentId:"sc-1v5tw03-2"})(["display:flex;justify-content:space-between;> *{flex:1 1 auto;&:not(:last-child){margin-right:",";}}"],c(20)),be=_(s).withConfig({displayName:"graph__SearchSection",componentId:"sc-1v5tw03-3"})(["max-height:calc(100% - ",");display:flex;flex-direction:column;&:not(:last-child){padding-bottom:0;}"],c(40)),Ce=_.div.withConfig({displayName:"graph__Loading",componentId:"sc-1v5tw03-4"})([""," display:flex;flex-direction:column;justify-content:center;align-items:center;overscroll-behavior:none;cursor:progress;font-size:",";line-height:",";"],_e("100%","100%"),c(16),c(60)),je=()=>{const{t:n}=Ue(["graph","common"]),[Q,N]=Re(),l=q(null),m=q(null),[P,R]=r(Q.graph.model),p=i(()=>{m.current&&(m.current.value="",m.current.click())},[]),V=i(t=>{const o=t.target;o&&o.files&&o.files.length&&(N({graph:{model:o.files}}),R(o.files))},[N]),{data:a,loading:v}=ve(P?null:"/graph/graph");H(()=>{(a==null?void 0:a.data.size)&&R([new File([a.data],a.filename||"unknwon_model")])},[a]);const[U,X]=r([]),[D,k]=r(""),Y=i(t=>{X(t.graphs),k(t.selected||"")},[]),F=i(t=>{var o;k(t),(o=l.current)===null||o===void 0||o.changeGraph(t)},[]),[z,w]=r(""),[u,B]=r(!1),[I,M]=r({text:"",result:[]}),A=i(t=>{var o;w(t),(o=l.current)===null||o===void 0||o.search(t)},[]),$=i(t=>{var o;w(t.name),(o=l.current)===null||o===void 0||o.select(t)},[]),[d,Z]=r(!1),[h,ee]=r(!0),[E,te]=r(!1),[S,oe]=r(!1),[ne,W]=r(null),[g,L]=r(null),[b,C]=r(null);H(()=>{w(""),M({text:"",result:[]})},[P,d,h,E]);const O=x(()=>u?null:e.createElement(K,{type:"primary",rounded:!0,onClick:p},n("graph:change-model")),[n,p,u]),[T,re]=r(!1),le=x(()=>!T||v?null:b?e.createElement(j,{width:c(360)},e.createElement(de,{data:b,onClose:()=>C(null)})):g?e.createElement(j,{width:c(360)},e.createElement(he,{data:g,onClose:()=>L(null),showNodeDodumentation:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.showNodeDocumentation(g)}})):e.createElement(j,{bottom:O},e.createElement(be,null,e.createElement(ge,{text:z,data:I,onChange:A,onSelect:$,onActive:()=>B(!0),onDeactive:()=>B(!1)})),!u&&e.createElement(e.Fragment,null,e.createElement(s,null,e.createElement(K,{onClick:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.showModelProperties()}},n("graph:model-properties"))),U.length>1&&e.createElement(s,null,e.createElement(f,{label:n("graph:subgraph")},e.createElement(we,{list:U,value:D,onChange:F}))),e.createElement(s,null,e.createElement(f,{label:n("graph:display-data")},e.createElement("div",null,e.createElement(G,{value:d,onChange:Z},n("graph:show-attributes"))),e.createElement("div",null,e.createElement(G,{value:h,onChange:ee},n("graph:show-initializers"))),e.createElement("div",null,e.createElement(G,{value:E,onChange:te},n("graph:show-node-names"))))),e.createElement(s,null,e.createElement(f,{label:n("graph:direction")},e.createElement(Ee,{value:S,onChange:oe},e.createElement(J,{value:!1},n("graph:vertical")),e.createElement(J,{value:!0},n("graph:horizontal"))))),e.createElement(s,null,e.createElement(f,{label:n("graph:export-file")},e.createElement(Se,null,e.createElement(y,{onClick:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.export("png")}},n("graph:export-png")),e.createElement(y,{onClick:()=>{var t;return(t=l.current)===null||t===void 0?void 0:t.export("svg")}},n("graph:export-svg"))))))),[n,O,z,u,I,U,D,F,A,$,d,h,E,S,T,v,g,b]),ae=x(()=>e.createElement(Pe,{onClickUpload:p,onDropFiles:R}),[p]);return e.createElement(e.Fragment,null,e.createElement(fe,null,n("common:graph")),e.createElement(ue,{data:ne,onClose:()=>W(null)}),e.createElement(me,{aside:le},v?e.createElement(Ce,null,e.createElement(pe,{size:"60px",color:ce})):e.createElement(se,{ref:l,files:P,uploader:ae,showAttributes:d,showInitializers:h,showNames:E,horizontal:S,onRendered:()=>re(!0),onOpened:Y,onSearch:t=>M(t),onShowModelProperties:t=>W(t),onShowNodeProperties:t=>{L(t),C(null)},onShowNodeDocumentation:t=>C(t)}),e.createElement("input",{ref:m,type:"file",multiple:!1,onChange:V,style:{display:"none"}})))};export default je;
