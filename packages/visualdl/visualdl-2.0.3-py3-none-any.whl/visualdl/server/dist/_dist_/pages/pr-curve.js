function P(){return P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},P.apply(this,arguments)}function k(e,t){if(e==null)return{};var r=q(e,t),n,i;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(e);for(i=0;i<p.length;i++){if(n=p[i],t.indexOf(n)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,n))continue;r[n]=e[n]}}return r}function q(e,t){if(e==null)return{};var r={},n=Object.keys(e),i,p;for(p=0;p<n.length;p++){if(i=n[p],t.indexOf(i)>=0)continue;r[i]=e[i]}return r}function T(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,n)}return r}function m(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?T(Object(r),!0).forEach(function(n){A(e,n,r[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):T(Object(r)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))})}return e}function A(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}import D from"../components/ChartPage.js";import a,{useCallback as x,useEffect as M,useMemo as j,useState as y}from"../../web_modules/react.js";import{borderColor as K,rem as U}from"../utils/style.js";import{AsideSection as E}from"../components/Aside.js";import L from"../components/Content.js";import N from"../components/Error.js";import z from"../components/Field.js";import B from"../components/PRCurvePage/PRCurveChart.js";import G from"../components/RunAside.js";import H from"../components/PRCurvePage/StepSlider.js";import J from"../components/TimeModeSelect.js";import{TimeType as Q}from"../resource/pr-curve/index.js";import V from"../components/Title.js";import{cycleFetcher as X}from"../utils/fetch.js";import Y from"../../web_modules/query-string.js";import Z from"../../web_modules/styled-components.js";import{useRunningRequest as ee}from"../hooks/useRequest.js";import te from"../hooks/useTagFilter.js";import{useTranslation as ne}from"../../web_modules/react-i18next.js";const re=Z.div.withConfig({displayName:"pr-curve__StepSliderWrapper",componentId:"sc-2ui709-0"})(["max-height:30vh;overflow:auto;overflow-x:hidden;overflow-y:auto;flex-shrink:0;> ",":last-child{padding-bottom:",";margin-bottom:0;}+ .run-section{border-top:1px solid ",";margin-top:0;padding-top:",";}&:empty + .run-section{border-top:none;}"],E,U(20),K,U(20)),oe=()=>{const{t:e}=ne(["pr-curve","common"]),[t,r]=y(!0),{runs:n,tags:i,runsInTags:p,selectedRuns:R,onChangeRuns:O,loading:_}=te("pr-curve",t),[w,C]=y({}),S=x((o,l)=>C(u=>m(m({},u),{},{[o]:l})),[]);M(()=>C(o=>p.reduce((l,u)=>(o[u.label]!=null&&(l[u.label]=o[u.label]),l),{})),[p]);const{data:s}=ee(p.map(o=>`/pr-curve/steps?${Y.stringify({run:o.label})}`),!!t,(...o)=>X(o)),d=j(()=>p.map((o,l)=>{var u,c,v,b,h;return m(m({},o),{},{index:(u=w[o.label])!==null&&u!==void 0?u:((c=s==null?void 0:s[l].length)!==null&&c!==void 0?c:1)-1,steps:(v=s==null?void 0:s[l].map(f=>f[1]))!==null&&v!==void 0?v:[],wallTimes:(b=s==null?void 0:s[l].map(f=>Math.floor(f[0])))!==null&&b!==void 0?b:[],relatives:(h=s==null?void 0:s[l].map(f=>f[0]-s[l][0][0]))!==null&&h!==void 0?h:[]})}),[p,s,w]),[g,I]=y(Q.Step),$=j(()=>i.map(o=>m(m({},o),{},{runs:o.runs.map(l=>m(m({},l),{},{index:0,steps:[],wallTimes:[],relatives:[]},d.find(u=>u.label===l.label)))})),[i,d]),F=j(()=>n.length?a.createElement(G,{runs:n,selectedRuns:R,onChangeRuns:O,running:t,onToggleRunning:r},a.createElement(E,null,a.createElement(z,{label:e("pr-curve:time-display-type")},a.createElement(J,{value:g,onChange:I}))),a.createElement(re,null,d.map(o=>a.createElement(E,{key:o.label},a.createElement(H,{run:o,type:g,onChange:l=>S(o.label,l)}))))):null,[e,O,t,n,R,g,d,S]),W=x(o=>{let{label:l,runs:u}=o,c=k(o,["label","runs"]);return a.createElement(B,P({runs:u,tag:l},c,{running:t}))},[t]);return a.createElement(a.Fragment,null,a.createElement(V,null,e("common:pr-curve")),a.createElement(L,{aside:F,loading:_},!_&&!n.length?a.createElement(N,null):a.createElement(D,{items:$,withChart:W,loading:_})))};export default oe;
