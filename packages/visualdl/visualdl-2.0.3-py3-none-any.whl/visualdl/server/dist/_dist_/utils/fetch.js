import h from"../../__snowpack__/env.js";import.meta.env=h;function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?y(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(e,t){if(e==null)return{};var n=P(e,t),r,a;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++){if(r=o[a],t.indexOf(r)>=0)continue;if(!Object.prototype.propertyIsEnumerable.call(e,r))continue;n[r]=e[r]}}return n}function P(e,t){if(e==null)return{};var n={},r=Object.keys(e),a,o;for(o=0;o<r.length;o++){if(a=r[o],t.indexOf(a)>=0)continue;n[a]=e[a]}return n}import b from"../../web_modules/i18next.js";import v from"../../web_modules/query-string.js";const u=import.meta.env.SNOWPACK_PUBLIC_API_TOKEN_KEY,E=import.meta.env.SNOWPACK_PUBLIC_API_URL,m="X-VisualDL-Instance-ID",l=u?v.parse(window.location.search)[u]:"";export function getApiToken(){return l??null}function j(e){const t=getApiToken();if(!u||!t)return e;const n=e||{},{headers:r}=n,a=_(n,["headers"]),o=new Headers(r);return Array.isArray(t)?t.forEach(i=>o.append(m,i)):o.append(m,t),O(O({},a),{},{headers:o})}function A(){return new Promise(e=>{b.changeLanguage(void 0).then(t=>e(t))})}function c(e){return import.meta.env.MODE==="development"&&console.error(e),A()}export async function fetcher(e,t){var n;let r;try{r=await fetch(E+e,j(t))}catch(o){const i=await c(o);throw new Error(i("errors:network-error"))}if(!r.ok){const o=await c(r);throw new Error(o([`errors:response-error.${r.status}`,"errors:response-error.unknown"]))}let a;if((n=r.headers.get("content-type"))===null||n===void 0?void 0:n.includes("application/json")){try{a=await r.json()}catch(o){const i=await c(o);throw new Error(i("errors:parse-error"))}if(a&&"status"in a)if(a.status!==0){const o=await c(a);throw new Error(a.msg||o("errors:error"))}else return a.data;return a}else{let o;try{o=await r.blob()}catch(s){const f=await c(s);throw new Error(f("errors:parse-error"))}const i=r.headers.get("Content-Disposition");o.arrayBuffer||(o.arrayBuffer=async()=>new Promise((s,f)=>{const d=new FileReader;d.addEventListener("load",w=>w.target?s(w.target.result):f()),d.readAsArrayBuffer(o)}));let p=null;if(i&&i.indexOf("attachment")!==-1){const s=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(i);s!=null&&s[1]&&(p=s[1].replace(/['"]/g,""))}return{data:o,type:r.headers.get("Content-Type"),filename:p}}}export const cycleFetcher=async(e,t)=>await Promise.all(e.map(n=>fetcher(n,t)));
