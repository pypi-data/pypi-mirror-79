jQuery(document).ready(function($){var nl2br=(function(string,isXhtml){var breakTag=(isXhtml||typeof isXhtml==="undefined")?"<br />":"<br>";return(string+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1"+breakTag+"$2");});var closeCopyMessageElement=(function(element){$(element).fadeTo(10000,500).slideUp(500,function(){$(this).slideUp(500,function(){$(this).remove();});});});var showSuccess=(function(message,element){$(element).html('<div class="alert alert-success alert-dismissable alert-copy-success"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+message+"</div>");closeCopyMessageElement(".alert-copy-success");return;});var showError=(function(message,element){$(element).html('<div class="alert alert-danger alert-dismissable alert-copy-error"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+message+"</div>");closeCopyMessageElement(".alert-copy-error");return;});var sanitizeInput=(function(input){if(input){return input.replace(/<(|\/|[^>\/bi]|\/[^>bi]|[^\/>][^>]+|\/[^>][^>]+)>/g,"");}else{return input;}});var sendEmbeddedDiscordPing=(function(discordWebhook,content,embeds){var request=new XMLHttpRequest();request.open("POST",discordWebhook);request.setRequestHeader("Content-type","application/json");var params={username:"",avatar_url:"",content:content,embeds:[embeds]};request.send(JSON.stringify(params));});var sendDiscordPing=(function(discordWebhook,discordPingText){var request=new XMLHttpRequest();request.open("POST",discordWebhook);request.setRequestHeader("Content-type","application/json");var params={username:"",avatar_url:"",content:discordPingText};request.send(JSON.stringify(params));});var sendSlackPing=(function(slackWebhook,payload){$.ajax({data:"payload="+JSON.stringify(payload),dataType:"json",processData:false,type:"POST",url:slackWebhook});});var hexToDecimal=(function(hexValue){return parseInt(hexValue.replace("#",""),16);});var getTimezonesUrl=(function(formupTime){var formupTimestamp=((new Date(formupTime+" UTC")).getTime())/1000;var timezonesUrl=discordPingformatterSettings.siteUrl+"timezones/?#"+formupTimestamp;return timezonesUrl;});var generateDiscordPing=(function(){var pingTarget=sanitizeInput($("select#pingTarget option:selected").val());var pingTargetText=sanitizeInput($("select#pingTarget option:selected").text());var fleetType=sanitizeInput($("select#fleetType option:selected").val());var webhookType=sanitizeInput($("select#pingChannel option:selected").data("webhook-type"));var webhookEmbedColor=sanitizeInput($("select#fleetType option:selected").data("embed-color"));var webhookEmbedPing=sanitizeInput($("select#pingChannel option:selected").data("webhook-embed"));var fcName=sanitizeInput($("input#fcName").val());var fleetName=sanitizeInput($("input#fleetName").val());var formupLocation=sanitizeInput($("input#formupLocation").val());var formupTime=sanitizeInput($("input#formupTime").val());var fleetComms=sanitizeInput($("input#fleetComms").val());var fleetDoctrine=sanitizeInput($("input#fleetDoctrine").val());var fleetSrp=sanitizeInput($("select#fleetSrp option:selected").val());var additionalInformation=sanitizeInput($("textarea#additionalInformation").val());console.log(webhookEmbedColor);console.log(webhookType);console.log(webhookEmbedPing);var discordWebhook=false;if($("select#pingChannel").length){discordWebhook=sanitizeInput($("select#pingChannel option:selected").val());}$(".aa-discord-ping-formatter-ping").show();var discordWebhookPingTextHeader="";var discordWebhookPingTextContent="";var discordWebhookPingTextFooter="";var discordPingText="";if(pingTargetText.indexOf("@")>-1){discordPingTarget=pingTargetText;}else{discordPingTarget="@"+pingTargetText;}if(pingTarget.indexOf("@")>-1){webhookPingTarget=pingTarget;}else{webhookPingTarget="<@&"+pingTarget+">";}discordPingText+=" :: ";discordPingText+="**";if($("input#prePing").is(":checked")){discordPingText+="### PRE PING ###";discordWebhookPingTextHeader+="### PRE PING ###";if(fleetType!==""){discordPingText+=" / "+fleetType+" Fleet";discordWebhookPingTextHeader+=" / "+fleetType+" Fleet";}else{discordPingText+=" / Fleet";discordWebhookPingTextHeader+=" / Fleet";}}else{if(fleetType!==""){discordPingText+=fleetType+" ";discordWebhookPingTextHeader+=fleetType+" ";}discordPingText+="Fleet is up";discordWebhookPingTextHeader+="Fleet is up";}discordPingText+="**\n";if(fcName!==""){discordPingText+="\n**FC:** "+fcName;discordWebhookPingTextContent+="\n**FC:** "+fcName;}if(fleetName!==""){discordPingText+="\n**Fleet Name:** "+fleetName;discordWebhookPingTextContent+="\n**Fleet Name:** "+fleetName;}if(formupLocation!==""){discordPingText+="\n**Formup Location:** "+formupLocation;discordWebhookPingTextContent+="\n**Formup Location:** "+formupLocation;}if($("input#formupTimeNow").is(":checked")){discordPingText+="\n**Formup Time:** NOW";discordWebhookPingTextContent+="\n**Formup Time:** NOW";}else{if(formupTime!==""){discordPingText+="\n**Formup Time:** "+formupTime;discordWebhookPingTextContent+="\n**Formup Time:** "+formupTime;if(discordPingformatterSettings.timezonesInstalled===true){var timezonesUrl=getTimezonesUrl(formupTime);discordPingText+=" - "+timezonesUrl;if(webhookType==="Discord"){discordWebhookPingTextContent+=" ([Time Zone Conversion]("+timezonesUrl+"))";}if(webhookType==="Slack"){discordWebhookPingTextContent+=" (<"+timezonesUrl+"|Time Zone Conversion>)";}}}}if(fleetComms!==""){discordPingText+="\n**Comms:** "+fleetComms;discordWebhookPingTextContent+="\n**Comms:** "+fleetComms;}if(fleetDoctrine!==""){discordPingText+="\n**Ships / Doctrine:** "+fleetDoctrine;discordWebhookPingTextContent+="\n**Ships / Doctrine:** "+fleetDoctrine;}if(fleetSrp!==""){discordPingText+="\n**SRP:** "+fleetSrp;discordWebhookPingTextContent+="\n**SRP:** "+fleetSrp;}if(additionalInformation!==""){discordPingText+="\n\n**Additional Information**:\n"+additionalInformation;discordWebhookPingTextContent+="\n\n**Additional Information**:\n"+additionalInformation;}if(discordPingformatterSettings.platformUsed==="Discord"){$(".aa-discord-ping-formatter-ping-text").html("<p>"+nl2br(discordPingTarget+discordPingText)+"</p>");}if(discordPingformatterSettings.platformUsed==="Slack"){$(".aa-discord-ping-formatter-ping-text").html("<p>"+nl2br(discordPingTarget+discordPingText.split("**").join("*"))+"</p>");}if(discordWebhook!==false&&discordWebhook!==""){if(discordPingformatterSettings.pingCreator!==""){discordPingText+="\n\n*(Ping sent by: "+discordPingformatterSettings.pingCreator+")*";discordWebhookPingTextFooter="(Ping sent by: "+discordPingformatterSettings.pingCreator+")";}var embedColor="#FAA61A";if(fleetType!==""&&embedColor!==""){embedColor=webhookEmbedColor;}if(fcName!==""){discordWebhookPingTextHeader+=" under "+fcName;}var copyPasteText="";if(webhookType==="Discord"){if(undefined!==webhookEmbedPing&&webhookEmbedPing==="True"){sendEmbeddedDiscordPing(discordWebhook,webhookPingTarget+" :: **"+discordWebhookPingTextHeader+"**\n** **",{title:"**.: Fleet Details :.**",description:discordWebhookPingTextContent,color:hexToDecimal(embedColor),footer:{text:discordWebhookPingTextFooter}});}else{sendDiscordPing(discordWebhook,webhookPingTarget+discordPingText);}}if(webhookType==="Slack"){var slackEmbedPingTarget=webhookPingTarget.replace("@","!");var payload={attachments:[{fallback:discordPingText,color:embedColor,pretext:"<"+slackEmbedPingTarget+"> :: *"+discordWebhookPingTextHeader+"*",text:"*.: Fleet Details :.*\n"+discordWebhookPingTextContent.split("**").join("*"),footer:discordWebhookPingTextFooter,}]};sendSlackPing(discordWebhook,payload);}showSuccess("Success, your ping has been sent to your "+discordPingformatterSettings.platformUsed+".",".aa-discord-ping-formatter-ping-copyresult");}});var copyDiscordPing=(function(){var clipboardDiscordPingData=new Clipboard("button#copyDiscordPing");clipboardDiscordPingData.on("success",function(e){showSuccess("Success, Ping copied to clipboard. Now be a good FC and throw it in your "+discordPingformatterSettings.platformUsed+" so you actually get some people in fleet.",".aa-discord-ping-formatter-ping-copyresult");e.clearSelection();clipboardDiscordPingData.destroy();});clipboardDiscordPingData.on("error",function(){showError("Error, Ping not copied to clipboard.",".aa-discord-ping-formatter-ping-copyresult");clipboardDiscordPingData.destroy();});});$("#prePing").on("change",function(){if($("input#prePing").is(":checked")){$("#formupTimeNow").removeAttr("checked");$("#formupTimeNow").prop("disabled",true);$("#formupTime").removeAttr("disabled");}else{$("#formupTimeNow").prop("checked",true);$("#formupTimeNow").removeAttr("disabled");$("#formupTime").prop("disabled",true);}});$("#formupTimeNow").on("change",function(){if($("input#formupTimeNow").is(":checked")){$("#formupTime").prop("disabled",true);}else{$("#formupTime").removeAttr("disabled");}});$("button#createPingText").on("click",function(){generateDiscordPing();});$("button#copyDiscordPing").on("click",function(){copyDiscordPing();});});